@using ProyectoMatrix.Models
@model ProyectoMatrix.Models.UniversidadDashboardViewModel

@{
    ViewData["Title"] = "Universidad NS Group";
    Layout = "_LayoutUniversidad"; // Crearemos este layout después
}

<div class="universidad-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="header-content">
                        <h1 class="dashboard-title">
                            <i class="fas fa-graduation-cap text-universidad me-3"></i>
                            @Model.GetTituloSeccion()
                        </h1>
                        <p class="dashboard-subtitle text-muted">
                            Bienvenido @Model.NombreUsuario - @Model.NombreEmpresa
                        </p>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="header-actions">
                        @if (Model.PuedeCrearCursos)
                        {
                            <a href="/Universidad/CrearCurso" class="btn btn-universidad me-2">
                                <i class="fas fa-plus me-2"></i>Crear Curso
                            </a>
                        }
                        @if (Model.PuedeAsignarCursos)
                        {
                            <a href="/Asignaciones/AsignacionMasiva" class="btn btn-outline-universidad">
                                <i class="fas fa-users me-2"></i>Asignar
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="container-fluid mt-4">
        <div class="row g-3">
            <!-- Mis Cursos Card -->
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-card-primary">
                    <div class="stat-card-body">
                        <div class="stat-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">@Model.Estadisticas.TotalCursosAsignados</h3>
                            <p class="stat-label">@(Model.RolId == 5 ? "Mis Cursos" : "Cursos Activos")</p>
                            <div class="stat-progress">
                                <div class="progress">
                                    <div class="progress-bar bg-primary"
                                         style="width: @(Model.Estadisticas.TotalCursosAsignados > 0 ? (Model.Estadisticas.CursosCompletados * 100 / Model.Estadisticas.TotalCursosAsignados) : 0)%">
                                    </div>
                                </div>
                                <small class="text-muted">@Model.Estadisticas.CursosCompletados completados</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progreso Card -->
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-card-success">
                    <div class="stat-card-body">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">@Model.Estadisticas.PromedioProgreso.ToString("F1")%</h3>
                            <p class="stat-label">Progreso Promedio</p>
                            <div class="stat-badge">
                                @if (Model.Estadisticas.PromedioProgreso >= 80)
                                {
                                    <span class="badge bg-success">Excelente</span>
                                }
                                else if (Model.Estadisticas.PromedioProgreso >= 60)
                                {
                                    <span class="badge bg-warning">Bien</span>
                                }
                                else
                                {
                                    <span class="badge bg-danger">Mejorar</span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Certificados Card -->
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-card-warning">
                    <div class="stat-card-body">
                        <div class="stat-icon">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">@Model.Estadisticas.CertificadosObtenidos</h3>
                            <p class="stat-label">Certificados</p>
                            <small class="text-muted">
                                <i class="fas fa-download me-1"></i>
                                <a href="/Universidad/MisCertificados" class="text-decoration-none">Ver todos</a>
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tiempo de Estudio Card -->
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-card-info">
                    <div class="stat-card-body">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">@Model.Estadisticas.TiempoTotalEstudioTexto</h3>
                            <p class="stat-label">Tiempo de Estudio</p>
                            <small class="text-muted">Total acumulado</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Cursos Section -->
            <div class="col-xl-8">
                @if (Model.RolId == 5) // Usuario Final
                {
                    <!-- Mis Cursos para Usuario Final -->
                    <div class="content-card">
                        <div class="content-card-header">
                            <h5 class="content-card-title">
                                <i class="fas fa-graduation-cap me-2"></i>Mis Capacitaciones
                            </h5>
                            <a href="/Universidad/MisCursos" class="btn btn-sm btn-outline-primary">Ver todos</a>
                        </div>
                        <div class="content-card-body">
                            @if (Model.MisCursos.Any())
                            {
                                <div class="row g-3">
                                    @foreach (var curso in Model.MisCursos.Take(4))
                                    {
                                        <div class="col-md-6">
                                            <div class="curso-card @(curso.ProximoVencimiento ? "border-warning" : "")">
                                                <div class="curso-card-header">
                                                    <div class="curso-nivel" style="background-color: @curso.ColorNivel">
                                                        @curso.NombreNivel
                                                    </div>
                                                    <span class="@curso.EstadoClass">@curso.Estado</span>
                                                </div>
                                                <div class="curso-card-body">
                                                    <h6 class="curso-title">@curso.NombreCurso</h6>
                                                    <p class="curso-description text-muted">@curso.Descripcion</p>

                                                    <div class="curso-progress mb-3">
                                                        <div class="d-flex justify-content-between mb-1">
                                                            <small>Progreso</small>
                                                            <small>@curso.PorcentajeProgreso.ToString("F0")%</small>
                                                        </div>
                                                        <div class="progress progress-sm">
                                                            <div class="progress-bar"
                                                                 style="width: @curso.PorcentajeProgreso%"
                                                                 role="progressbar">
                                                            </div>
                                                        </div>
                                                        <small class="text-muted">
                                                            @curso.SubCursosCompletados de @curso.TotalSubCursos módulos
                                                        </small>
                                                    </div>

                                                    @if (curso.TieneFechaLimite)
                                                    {
                                                        <div class="curso-fecha-limite mb-2">
                                                            <small class="@(curso.ProximoVencimiento ? "text-warning" : "text-muted")">
                                                                <i class="fas fa-calendar-alt me-1"></i>
                                                                Fecha límite: @curso.FechaLimiteTexto
                                                            </small>
                                                        </div>
                                                    }
                                                </div>
                                                <div class="curso-card-footer">
                                                    <a href="/Universidad/TomarCurso/@curso.CursoID"
                                                       class="btn btn-sm btn-universidad">
                                                        @(curso.Estado == "Completado" ? "Revisar" : "Continuar")
                                                        <i class="fas fa-arrow-right ms-1"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="empty-state text-center py-5">
                                    <i class="fas fa-book-open fa-3x text-muted mb-3"></i>
                                    <h6 class="text-muted">No tienes cursos asignados</h6>
                                    <p class="text-muted">Los cursos asignados aparecerán aquí</p>
                                </div>
                            }
                        </div>
                    </div>
                }
                else
                {
                    <!-- Vista Administrativa -->
                    <div class="content-card">
                        <div class="content-card-header">
                            <h5 class="content-card-title">
                                <i class="fas fa-cogs me-2"></i>Panel de Administración
                            </h5>
                            <a href="/Universidad/GestionCursos" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-book me-1"></i>Gestionar Cursos
                            </a>
                        </div>
                        <div class="content-card-body">
                            <div class="row g-4">
                                <!-- Estadísticas principales -->
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <div class="metric-icon bg-primary">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div class="metric-content">
                                            <h4>@Model.Estadisticas.TotalUsuariosActivos</h4>
                                            <p class="text-muted">Usuarios Activos</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <div class="metric-icon bg-success">
                                            <i class="fas fa-book"></i>
                                        </div>
                                        <div class="metric-content">
                                            <h4>@Model.Estadisticas.TotalCursosCreados</h4>
                                            <p class="text-muted">Cursos Creados</p>
                                            <small class="text-info">
                                                <a href="/Universidad/GestionCursos" class="text-decoration-none">
                                                    <i class="fas fa-cog me-1"></i>Gestionar
                                                </a>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <div class="metric-icon bg-warning">
                                            <i class="fas fa-certificate"></i>
                                        </div>
                                        <div class="metric-content">
                                            <h4>@Model.Estadisticas.CertificadosEmitidosMes</h4>
                                            <p class="text-muted">Certificados este mes</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <div class="metric-icon bg-info">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                        <div class="metric-content">
                                            <h4>@Model.Estadisticas.PromedioProgreso.ToString("F1")%</h4>
                                            <p class="text-muted">Progreso Promedio</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @if (Model.PuedeCrearCursos || Model.PuedeAsignarCursos)
                            {
                                <div class="mt-4 pt-4 border-top">
                                    <h6 class="mb-3">
                                        <i class="fas fa-bolt me-2"></i>Acciones Rápidas
                                    </h6>
                                    <div class="row g-2">
                                        @if (Model.PuedeCrearCursos)
                                        {
                                            <div class="col-md-6">
                                                <a href="/Universidad/CrearCurso" class="btn btn-universidad w-100">
                                                    <i class="fas fa-plus me-2"></i>Crear Nuevo Curso
                                                </a>
                                            </div>
                                            <div class="col-md-6">
                                                <a href="/Universidad/GestionCursos" class="btn btn-outline-universidad w-100">
                                                    <i class="fas fa-cogs me-2"></i>Gestionar Cursos
                                                </a>
                                            </div>
                                        }
                                        @if (Model.PuedeAsignarCursos)
                                        {
                                            <div class="col-md-6">
                                                <a href="/Asignaciones/AsignacionMasiva" class="btn btn-outline-primary w-100">
                                                    <i class="fas fa-users me-2"></i>Asignar Cursos
                                                </a>
                                            </div>
                                        }
                                        @if (Model.PuedeVerReportes)
                                        {
                                            <div class="col-md-6">
                                                <a href="/Universidad/Reportes" class="btn btn-outline-info w-100">
                                                    <i class="fas fa-chart-bar me-2"></i>Ver Reportes
                                                </a>
                                            </div>
                                        }
                                    </div>
                                </div>
                          }

                        </div>
                    </div>
                }
            </div>

            <!-- Sidebar -->
            <div class="col-xl-4">
                <!-- Certificados Recientes -->
                @if (Model.MisCertificados.Any())
                {
                    <div class="content-card mb-4">
                        <div class="content-card-header">
                            <h6 class="content-card-title">
                                <i class="fas fa-award me-2"></i>Certificados Recientes
                            </h6>
                        </div>
                        <div class="content-card-body">
                            @foreach (var certificado in Model.MisCertificados.Take(3))
                            {
                                <div class="certificado-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="certificado-icon me-3">
                                            <i class="fas fa-certificate text-warning"></i>
                                        </div>
                                        <div class="certificado-content flex-grow-1">
                                            <h6 class="mb-1">@certificado.NombreCurso</h6>
                                            <small class="text-muted">
                                                @certificado.FechaEmisionTexto - @certificado.NombreNivel
                                            </small>
                                            <div class="mt-1">
                                                <span class="@certificado.EstadoClass">@certificado.Estado</span>
                                            </div>
                                        </div>
                                        @if (certificado.TieneArchivo)
                                        {
                                            <a href="/Universidad/DescargarCertificado/@certificado.CertificadoID"
                                               class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-download"></i>
                                            </a>
                                        }
                                    </div>
                                </div>
                            }
                            <div class="text-center">
                                <a href="/Universidad/MisCertificados" class="btn btn-sm btn-outline-primary">
                                    Ver todos los certificados
                                </a>
                            </div>
                        </div>
                    </div>
                }

                <!-- Accesos Rápidos -->
                <div class="content-card">
                    <div class="content-card-header">
                        <h6 class="content-card-title">
                            <i class="fas fa-bolt me-2"></i>Accesos Rápidos
                        </h6>
                    </div>
                    <div class="content-card-body">
                        <div class="quick-links">
                            @foreach (var menuItem in Model.MenuItems.Where(m => !m.SubItems.Any()))
                            {
                                <a href="@menuItem.Url" class="quick-link-item">
                                    <i class="@menuItem.Icono me-2"></i>
                                    @menuItem.Titulo
                                    @if (menuItem.Badge.HasValue && menuItem.Badge > 0)
                                    {
                                        <span class="badge bg-primary ms-auto">@menuItem.Badge</span>
                                    }
                                    <i class="fas fa-chevron-right ms-auto"></i>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --primary: #004AAD; /* Azul corporativo NS */
        --secondary: #FF6F00; /* Naranja acento */
        --success: #2E7D32;
        --warning: #FFC107;
        --info: #0288D1;
        --danger: #D32F2F;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-600: #4b5563;
        --gray-800: #1f2937;
    }

    .universidad-dashboard {
        min-height: 100vh;
        background: linear-gradient(135deg, #f8fafc 0%, #eef4ff 100%);
        font-family: 'Segoe UI', Roboto, sans-serif;
    }

    .dashboard-header {
        background: white;
        border-bottom: 4px solid var(--primary);
        padding: 2rem 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .dashboard-title {
        color: var(--primary);
        font-weight: 800;
        font-size: 1.8rem;
    }

    .dashboard-subtitle {
        color: var(--gray-600);
        font-size: 1rem;
    }

    /* ==== BOTONES ==== */
    .btn-universidad {
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 0.6rem 1.2rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

        .btn-universidad:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

    .btn-outline-universidad {
        color: var(--primary);
        border: 2px solid var(--primary);
        border-radius: 10px;
        padding: 0.5rem 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

        .btn-outline-universidad:hover {
            background: var(--primary);
            color: white;
        }

    /* ==== TARJETAS ESTADÍSTICAS ==== */
    .stat-card {
        border-radius: 14px;
        color: var(--gray-800);
        background: white;
        padding: 1.8rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

        .stat-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 8px 18px rgba(0,0,0,0.12);
        }

    .stat-icon {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        opacity: 0.9;
        color: white;
    }

    .stat-card-primary .stat-icon {
        background: var(--primary);
    }

    .stat-card-success .stat-icon {
        background: var(--success);
    }

    .stat-card-warning .stat-icon {
        background: var(--warning);
    }

    .stat-card-info .stat-icon {
        background: var(--info);
    }

    .stat-number {
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        color: var(--gray-800);
    }

    .stat-label {
        font-size: 1rem;
        color: var(--gray-600);
        font-weight: 500;
    }

    /* ==== CONTENEDORES ==== */
    .content-card {
        background: white;
        border-radius: 14px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        margin-bottom: 1.5rem;
        overflow: hidden;
        transition: all 0.3s ease;
    }

        .content-card:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
        }

    .content-card-header {
        padding: 1.2rem 1.5rem;
        border-bottom: 1px solid var(--gray-200);
        background: var(--gray-50);
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .content-card-title {
        color: var(--primary);
        font-size: 1.1rem;
        margin: 0;
    }

    /* ==== CURSOS ==== */
    .curso-card {
        border-radius: 10px;
        border: 1px solid var(--gray-200);
        background: #fff;
        transition: all 0.3s ease;
    }

        .curso-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.1);
        }

    .curso-card-header {
        padding: 0.8rem 1rem;
        background: var(--gray-100);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .curso-title {
        font-weight: 700;
        color: var(--gray-800);
    }

    .curso-description {
        font-size: 0.9rem;
        color: var(--gray-600);
    }

    /* ==== BADGES ==== */
    .badge {
        padding: 0.4rem 0.7rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 700;
    }

        .badge.bg-success {
            background: var(--success);
            color: #fff;
        }

        .badge.bg-warning {
            background: var(--warning);
            color: #000;
        }

        .badge.bg-danger {
            background: var(--danger);
            color: #fff;
        }

        .badge.bg-info {
            background: var(--info);
            color: #fff;
        }

    /* ==== LINKS RÁPIDOS ==== */
    .quick-link-item {
        display: flex;
        align-items: center;
        padding: 0.9rem 1rem;
        border-radius: 10px;
        background: var(--gray-50);
        margin-bottom: 0.5rem;
        color: var(--gray-700);
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
    }

        .quick-link-item:hover {
            background: var(--secondary);
            color: #fff !important;
        }

    /* ==== CERTIFICADOS ==== */
    .certificado-item {
        padding: 1rem 0;
        border-bottom: 1px solid var(--gray-200);
    }

        .certificado-item h6 {
            font-weight: 600;
            color: var(--gray-800);
        }
</style>
