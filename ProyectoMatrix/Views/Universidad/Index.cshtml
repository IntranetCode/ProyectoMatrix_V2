@using ProyectoMatrix.Models
@model ProyectoMatrix.Models.UniversidadDashboardViewModel

@{
    ViewData["Title"] = "Universidad NS Group";
    Layout = "_LayoutUniversidad"; // Crearemos este layout después
}


<link rel="stylesheet" href="~/css/stylesUniversidadIndex.css" asp-append-version="true" />


<div class="universidad-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="header-content">
                        <h1 class="dashboard-title">
                            <i class="fas fa-graduation-cap text-universidad me-3"></i>
                            @Model.GetTituloSeccion()
                        </h1>
                        <p class="dashboard-subtitle text-muted">
                            Bienvenido @Model.NombreUsuario - @Model.NombreEmpresa
                        </p>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="header-actions">
                        @if (Model.PuedeCrearCursos)
                        {
                            <a href="/Universidad/CrearCurso" data-overlay-trigger class="btn btn-universidad me-2">
                                <i class="fas fa-plus me-2"></i>Crear Curso
                            </a>
                        }
                        @if (Model.PuedeAsignarCursos)
                        {
                            <a href="/Asignaciones/AsignacionMasiva" data-overlay-trigger class="btn btn-outline-universidad">
                                <i class="fas fa-users me-2"></i>Asignar
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="container-fluid mt-4">
        <div class="row g-3">
            <!-- Mis Cursos Card -->
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-card-primary">
                    <div class="stat-card-body">
                        <div class="stat-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">@Model.Estadisticas.TotalCursosAsignados</h3>
                            <p class="stat-label">@(Model.RolId == 5 ? "Mis Cursos" : "Cursos Activos")</p>
                            <div class="stat-progress">
                                <div class="progress">
                                    <div class="progress-bar bg-primary"
                                         style="width: @(Model.Estadisticas.TotalCursosAsignados > 0 ? (Model.Estadisticas.CursosCompletados * 100 / Model.Estadisticas.TotalCursosAsignados) : 0)%">
                                    </div>
                                </div>
                                <small class="text-muted">@Model.Estadisticas.CursosCompletados completados</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progreso Card -->
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-card-success">
                    <div class="stat-card-body">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">@Model.Estadisticas.PromedioProgreso.ToString("F1")%</h3>
                            <p class="stat-label">Progreso Promedio</p>
                            <div class="stat-badge">
                                @if (Model.Estadisticas.PromedioProgreso >= 80)
                                {
                                    <span class="badge bg-success">Excelente</span>
                                }
                                else if (Model.Estadisticas.PromedioProgreso >= 60)
                                {
                                    <span class="badge bg-warning">Bien</span>
                                }
                                else
                                {
                                    <span class="badge bg-danger">Mejorar</span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Certificados Card -->
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-card-warning">
                    <div class="stat-card-body">
                        <div class="stat-icon">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">@Model.Estadisticas.CertificadosObtenidos</h3>
                            <p class="stat-label">Certificados</p>
                            <small class="text-muted">
                                <i class="fas fa-download me-1"></i>
                                <a href="/Universidad/MisCertificados" data-overlay-trigger class="text-decoration-none">Ver todos</a>
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tiempo de Estudio Card -->
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-card-info">
                    <div class="stat-card-body">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">@Model.Estadisticas.TiempoTotalEstudioTexto</h3>
                            <p class="stat-label">Tiempo de Estudio</p>
                            <small class="text-muted">Total acumulado</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Cursos Section -->
            <div class="col-xl-8">
                @if (Model.RolId == 5 || Model.RolId == 8) // Usuario Final
                {
                    <!-- Mis Cursos para Usuario Final -->
                    <div class="content-card">
                        <div class="content-card-header">
                            <h5 class="content-card-title">
                                <i class="fas fa-graduation-cap me-2"></i>Mis Capacitaciones
                            </h5>
                            <a href="/Universidad/MisCursos" data-overlay-trigger class="btn btn-sm btn-outline-primary">Ver todos</a>
                        </div>
                        <div class="content-card-body">
                            @if (Model.MisCursos.Any())
                            {
                                <div class="row g-3">
                                    @foreach (var curso in Model.MisCursos.Take(4))
                                    {
                                        <div class="col-md-6">
                                            <div class="curso-card @(curso.ProximoVencimiento ? "border-warning" : "")">
                                                <div class="curso-card-header">
                                                    <div class="curso-nivel" style="background-color: @curso.ColorNivel">
                                                        @curso.NombreNivel
                                                    </div>
                                                    <span class="@curso.EstadoClass">@curso.Estado</span>
                                                </div>
                                                <div class="curso-card-body">
                                                    <h6 class="curso-title">@curso.NombreCurso</h6>
                                                    <p class="curso-description text-muted">@curso.Descripcion</p>

                                                    <div class="curso-progress mb-3">
                                                        <div class="d-flex justify-content-between mb-1">
                                                            <small>Progreso</small>
                                                            <small>@curso.PorcentajeProgreso.ToString("F0")%</small>
                                                        </div>
                                                        <div class="progress progress-sm">
                                                            <div class="progress-bar"
                                                                 style="width: @curso.PorcentajeProgreso%"
                                                                 role="progressbar">
                                                            </div>
                                                        </div>
                                                        <small class="text-muted">
                                                            @curso.SubCursosCompletados de @curso.TotalSubCursos módulos
                                                        </small>
                                                    </div>

                                                    @if (curso.TieneFechaLimite)
                                                    {
                                                        <div class="curso-fecha-limite mb-2">
                                                            <small class="@(curso.ProximoVencimiento ? "text-warning" : "text-muted")">
                                                                <i class="fas fa-calendar-alt me-1"></i>
                                                                Fecha límite: @curso.FechaLimiteTexto
                                                            </small>
                                                        </div>
                                                    }
                                                </div>
                                                <div class="curso-card-footer">
                                                    <a href="/Universidad/TomarCurso/@curso.CursoID"
                                                       class="btn btn-sm btn-universidad">
                                                        @(curso.Estado == "Completado" ? "Revisar" : "Continuar")
                                                        <i class="fas fa-arrow-right ms-1"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="empty-state text-center py-5">
                                    <i class="fas fa-book-open fa-3x text-muted mb-3"></i>
                                    <h6 class="text-muted">No tienes cursos asignados</h6>
                                    <p class="text-muted">Los cursos asignados aparecerán aquí</p>
                                </div>
                            }
                        </div>
                    </div>
                }
                else
                {
                    <!-- Vista Administrativa -->
                    <div class="content-card">
                        <div class="content-card-header">
                            <h5 class="content-card-title">
                                <i class="fas fa-cogs me-2"></i>Panel de Administración
                            </h5>
                            <a href="/Universidad/GestionCursos" data-overlay-trigger class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-book me-1"></i>Gestionar Cursos
                            </a>
                        </div>
                        <div class="content-card-body">
                            <div class="row g-4">
                                <!-- Estadísticas principales -->
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <div class="metric-icon bg-primary">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div class="metric-content">
                                            <h4>@Model.Estadisticas.TotalUsuariosActivos</h4>
                                            <p class="text-muted">Usuarios Activos</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <div class="metric-icon bg-success">
                                            <i class="fas fa-book"></i>
                                        </div>
                                        <div class="metric-content">
                                            <h4>@Model.Estadisticas.TotalCursosCreados</h4>
                                            <p class="text-muted">Cursos Creados</p>
                                            <small class="text-info">
                                                <a href="/Universidad/GestionCursos" data-overlay-trigger class="text-decoration-none">
                                                    <i class="fas fa-cog me-1"></i>Gestionar
                                                </a>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <div class="metric-icon bg-warning">
                                            <i class="fas fa-certificate"></i>
                                        </div>
                                        <div class="metric-content">
                                            <h4>@Model.Estadisticas.CertificadosEmitidosMes</h4>
                                            <p class="text-muted">Certificados este mes</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <div class="metric-icon bg-info">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                        <div class="metric-content">
                                            <h4>@Model.Estadisticas.PromedioProgreso.ToString("F1")%</h4>
                                            <p class="text-muted">Progreso Promedio</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @*
                            @if (Model.PuedeCrearCursos || Model.PuedeAsignarCursos)
                            {
                                <div class="mt-4 pt-4 border-top">
                                    <h6 class="mb-3">
                                        <i class="fas fa-bolt me-2"></i>Acciones Rápidas
                                    </h6>
                                    <div class="row g-2">
                                        @if (Model.PuedeCrearCursos)
                                        {
                                            <div class="col-md-6">
                                                <a href="/Universidad/CrearCurso" class="btn btn-universidad w-100">
                                                    <i class="fas fa-plus me-2"></i>Crear Nuevo Curso
                                                </a>
                                            </div>
                                            <div class="col-md-6">
                                                <a href="/Universidad/GestionCursos" class="btn btn-outline-universidad w-100">
                                                    <i class="fas fa-cogs me-2"></i>Gestionar Cursos
                                                </a>
                                            </div>
                                        }
                                        @if (Model.PuedeAsignarCursos)
                                        {
                                            <div class="col-md-6">
                                                <a href="/Asignaciones/AsignacionMasiva" class="btn btn-outline-primary w-100">
                                                    <i class="fas fa-users me-2"></i>Asignar Cursos
                                                </a>
                                            </div>
                                        }
                                        
                                             @if (Model.PuedeVerReportes)
                                        {
                                            <div class="col-md-6">
                                                <a href="/Universidad/Reportes" class="btn btn-outline-info w-100">
                                                    <i class="fas fa-chart-bar me-2"></i>Ver Reportes
                                                </a>
                                            </div>
                                        }

                                       
                                       
                                    </div>
                                </div>
                            } *@

                        </div>
                    </div>
                }
            </div>

            <!-- Sidebar -->
            <div class="col-xl-4">
                <!-- Certificados Recientes -->
                @if (Model.MisCertificados.Any())
                {
                    <div class="content-card mb-4">
                        <div class="content-card-header">
                            <h6 class="content-card-title">
                                <i class="fas fa-award me-2"></i>Certificados Recientes
                            </h6>
                        </div>
                        <div class="content-card-body">
                            @foreach (var certificado in Model.MisCertificados.Take(3))
                            {
                                <div class="certificado-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="certificado-icon me-3">
                                            <i class="fas fa-certificate text-warning"></i>
                                        </div>
                                        <div class="certificado-content flex-grow-1">
                                            <h6 class="mb-1">@certificado.NombreCurso</h6>
                                            <small class="text-muted">
                                                @certificado.FechaEmisionTexto - @certificado.NombreNivel
                                            </small>
                                            <div class="mt-1">
                                                <span class="@certificado.EstadoClass">@certificado.Estado</span>
                                            </div>
                                        </div>
                                        @if (certificado.TieneArchivo)
                                        {
                                            <a href="/Universidad/DescargarCertificado/@certificado.CertificadoID" data-overlay-trigger
                                               class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-download"></i>
                                            </a>
                                        }
                                    </div>
                                </div>
                            }
                            <div class="text-center">
                                <a href="/Universidad/MisCertificados" data-overlay-trigger class="btn btn-sm btn-outline-primary">
                                    Ver todos los certificados
                                </a>
                            </div>
                        </div>
                    </div>
                }
                @*
                <!-- Accesos Rápidos -->
                <div class="content-card">
                    <div class="content-card-header">
                        <h6 class="content-card-title">
                            <i class="fas fa-bolt me-2"></i>Accesos Rápidos
                        </h6>
                    </div>
                    <div class="content-card-body">
                        <div class="quick-links">
                            @foreach (var menuItem in Model.MenuItems.Where(m => !m.SubItems.Any()))
                            {
                                <a href="@menuItem.Url" class="quick-link-item">
                                    <i class="@menuItem.Icono me-2"></i>
                                    @menuItem.Titulo
                                    @if (menuItem.Badge.HasValue && menuItem.Badge > 0)
                                    {
                                        <span class="badge bg-primary ms-auto">@menuItem.Badge</span>
                                    }
                                    <i class="fas fa-chevron-right ms-auto"></i>
                                </a>
                            }
                        </div>
                    </div>
                </div>  *@
            </div>
        </div>
    </div>
</div>


<style>


    .content-card {
        /* Priorizar estilos de caja modernos */
        background-color: #ffffff;
        border-radius: 16px; /* Esquinas más redondeadas */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Sombra suave y elevada */
        padding: 30px;
        margin-bottom: 25px;
        border: 1px solid #e0e0e0; /* Borde sutil */
    }

    .content-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 15px;
        margin-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
    }

    .content-card-title {
        font-size: 1.75rem; /* Título más grande */
        font-weight: 700;
        color: #343a40;
        margin: 0;
    }


    .metric-item {
        display: flex;
        align-items: center;
        padding: 20px;
        border-radius: 12px;
        background-color: #fff;
        /* Sombra y transición para efecto de "pop" */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        height: 100%; /* Asegura que todas las métricas tengan la misma altura */
        border-left: 5px solid transparent; /* Borde izquierdo dinámico */
    }

        .metric-item:hover {
            transform: translateY(-4px); /* Pequeña elevación al pasar el mouse */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

    .metric-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        color: #ffffff;
        font-size: 1.5rem;
        margin-right: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .metric-content h4 {
        font-size: 1.8rem;
        font-weight: 800; /* Números muy prominentes */
        color: #212529;
        margin-bottom: 2px;
    }

    .metric-content p {
        font-size: 0.9rem;
        color: #6c757d !important; /* Asegura la prioridad del color para el texto 'muted' */
        margin: 0;
    }

   

    /* Adaptar el borde izquierdo a los colores de fondo */
    .metric-icon.bg-primary {
        background-color: #0d6efd;
    }

    .col-md-6:nth-child(1) .metric-item { /* Targeting the first metric item in the row */
        border-left-color: #0d6efd;
    }

    .metric-icon.bg-success {
        background-color: #198754;
    }

    .col-md-6:nth-child(2) .metric-item { /* Targeting the second metric item in the row */
        border-left-color: #198754;
    }

    .metric-icon.bg-warning {
        background-color: #ffc107;
        color: #212529; /* Cambiar color de icono si el fondo es claro */
    }

    .col-md-6:nth-child(3) .metric-item { /* Targeting the third metric item in the row */
        border-left-color: #ffc107;
    }

    .metric-icon.bg-info {
        background-color: #0dcaf0;
    }

    .col-md-6:nth-child(4) .metric-item { /* Targeting the fourth metric item in the row */
        border-left-color: #0dcaf0;
    }

    /* Estilo para el enlace 'Gestionar' dentro de la métrica de Cursos */
    .metric-content a {
        color: #0dcaf0 !important; /* Usar el color info para este enlace específico */
        text-decoration: none;
        font-weight: 600;
    }

        .metric-content a:hover {
            text-decoration: underline;
        }


    /* Mejora del botón "Gestionar Cursos" en el header */
    .btn-outline-primary {
        border-color: #0d6efd;
        color: #0d6efd;
        font-weight: 600;
        transition: background-color 0.2s ease, box-shadow 0.2s ease;
    }

        .btn-outline-primary:hover {
            background-color: #0d6efd;
            color: #ffffff;
            box-shadow: 0 2px 8px rgba(13, 110, 253, 0.4);
        }
</style>