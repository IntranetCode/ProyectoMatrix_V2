
@{
    ViewData["Title"] = "Comunicados - Intranet";
    Layout = "~/Views/Shared/_Colaborador.cshtml";
}

<link href="~/css/stylesComunicadosIndex.css" rel="stylesheet" />

<div class="container py-4">
    <h2 class="mb-4"><i class="fas fa-bullhorn"></i> Comunicados</h2>

    <!-- COMUNICADO 1: Felicitaciones de Cumpleaños -->
    <div class="comunicado-card comunicado-with-image">
        <div class="comunicado-text">
            <div class="d-flex align-items-center comunicado-title">
                <i class="fas fa-birthday-cake comunicado-icon icon-informativo"></i>
                ¡Felicitaciones a nuestros cumpleañeros de julio!
            </div>
            <div class="comunicado-meta">Publicado: 01/07/2025 - Recursos Humanos</div>
            <div class="comunicado-content">
                En NS Group celebramos a nuestro equipo. Este mes felicitamos a todos nuestros colaboradores que cumplen años en julio. ¡Que tengan un excelente día!
            </div>
        </div>
        <div class="comunicado-img-container">
            <img src="~/imagenes/comunicados/cumpleanos-julio.jpg"
                 alt="Cumpleañeros de Julio"
                 class="comunicado-img clickable-image"
                 data-title="Felicitaciones a nuestros cumpleañeros de julio" />
            <div class="img-clickable-badge">
                <i class="fas fa-search-plus"></i> Click para ampliar
            </div>
        </div>
    </div>

    <!-- COMUNICADO 2: Bienvenida nuevo colaborador -->
    <div class="comunicado-card comunicado-with-image">
        <div class="comunicado-text">
            <div class="d-flex align-items-center comunicado-title">
                <i class="fas fa-user-plus comunicado-icon icon-informativo"></i>
                Le damos la más cordial bienvenida a Luis Alonso
            </div>
            <div class="comunicado-meta">Publicado: 26/06/2025 - Comunicación Interna</div>
            <div class="comunicado-content">
                Nos complace anunciar que Luis Alonso Basurto Martínez se integra a nuestro equipo como Asesor de Equipamiento. ¡Le deseamos mucho éxito!
            </div>
        </div>
        <div class="comunicado-img-container">
            <img src="~/imagenes/comunicados/bienvenida-luis.png"
                 alt="Bienvenida Luis Alonso"
                 class="comunicado-img clickable-image"
                 data-title="Bienvenida a Luis Alonso Basurto Martínez" />
            <div class="img-clickable-badge">
                <i class="fas fa-search-plus"></i> Click para ampliar
            </div>
        </div>
    </div>

    <!-- COMUNICADO 3: Solicitudes por WhatsApp -->
    <div class="comunicado-card comunicado-with-image">
        <div class="comunicado-text">
            <div class="d-flex align-items-center comunicado-title">
                <i class="fas fa-mobile-alt comunicado-icon icon-aviso"></i>
                Nuevas solicitudes por WhatsApp
            </div>
            <div class="comunicado-meta">Publicado: 25/06/2025 - Sistemas</div>
            <div class="comunicado-content">
                A partir de ahora, los colaboradores podrán realizar solicitudes de compras, logística y otros servicios a través de WhatsApp con código QR.
            </div>
        </div>
        <div class="comunicado-img-container">
            <img src="~/imagenes/comunicados/formulario_compras.png"
                 alt="Formulario Compras"
                 class="comunicado-img clickable-image"
                 data-title="Formulario Compras - Código QR" />
            <div class="img-clickable-badge">
                <i class="fas fa-search-plus"></i> Click para ampliar
            </div>
        </div>
    </div>

    <!-- COMUNICADO 4: sin imagen -->
    <div class="comunicado-card">
        <div class="d-flex align-items-center comunicado-title">
            <i class="fas fa-exclamation-triangle comunicado-icon icon-urgente"></i>
            Mantenimiento de sistemas programado
        </div>
        <div class="comunicado-meta">Publicado: 24/06/2025 - Sistemas</div>
        <div class="comunicado-content">
            El próximo viernes de 6:00 PM a 8:00 PM se realizará mantenimiento en los servidores. Los sistemas podrían presentar interrupciones durante este período.
        </div>
    </div>

    <!-- COMUNICADO 5: Recordatorio capacitación -->
    <div class="comunicado-card">
        <div class="d-flex align-items-center comunicado-title">
            <i class="fas fa-graduation-cap comunicado-icon icon-informativo"></i>
            Recordatorio: Capacitación en Universidad NS Group
        </div>
        <div class="comunicado-meta">Publicado: 23/06/2025 - Universidad NS Group</div>
        <div class="comunicado-content">
            No olvides completar los cursos asignados en la Universidad NS Group. El plazo vence el 30 de junio. ¡Tu desarrollo profesional es importante para nosotros!
        </div>
    </div>
</div>

<!-- Modal con zoom y pan -->
<div id="imageModal" class="image-modal">
    <div class="image-modal-content">
        <span class="image-modal-close">&times;</span>
        <div class="image-modal-header" id="modalTitle">Comunicado</div>
        <div class="modal-instructions">
            <i class="fas fa-info-circle"></i> Usa los controles para hacer zoom y arrastra para mover la imagen
        </div>

        <div class="image-container" id="imageContainer">
            <img id="modalImage" class="modal-image" src="" alt="">
        </div>

        <div class="zoom-controls">
            <button class="zoom-btn" id="zoomOut" title="Alejar">
                <i class="fas fa-minus"></i>
            </button>
            <input type="range" class="zoom-slider" id="zoomSlider" min="25" max="300" value="100" step="25">
            <div class="zoom-level" id="zoomLevel">100%</div>
            <button class="zoom-btn" id="zoomIn" title="Acercar">
                <i class="fas fa-plus"></i>
            </button>
            <button class="zoom-btn" id="resetZoom" title="Tamaño original">
                <i class="fas fa-expand-arrows-alt"></i>
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables para el modal y zoom
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const closeBtn = document.querySelector('.image-modal-close');
            const imageContainer = document.getElementById('imageContainer');
            const zoomSlider = document.getElementById('zoomSlider');
            const zoomLevel = document.getElementById('zoomLevel');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const resetZoomBtn = document.getElementById('resetZoom');

            let currentZoom = 100;
            let isDragging = false;
            let startX, startY, initialX, initialY;

            // Abrir modal con imagen
            document.querySelectorAll('.clickable-image').forEach(function(img) {
                img.addEventListener('click', function() {
                    const imgSrc = this.src;
                    const imgAlt = this.alt;
                    const imgTitle = this.getAttribute('data-title') || imgAlt;

                    const testImg = new Image();
                    testImg.onload = function() {
                        modalImg.src = imgSrc;
                        modalImg.alt = imgAlt;
                        modalTitle.textContent = imgTitle;
                        modal.style.display = 'block';
                        document.body.style.overflow = 'hidden';
                        resetImagePosition();
                    };
                    testImg.onerror = function() {
                        alert('La imagen no está disponible en este momento.');
                    };
                    testImg.src = imgSrc;
                });
            });

            // Función para resetear posición y zoom
            function resetImagePosition() {
                currentZoom = 100;
                modalImg.style.transform = 'translate(-50%, -50%) scale(1)';
                zoomSlider.value = 100;
                zoomLevel.textContent = '100%';
            }

            // Control de zoom con slider
            zoomSlider.addEventListener('input', function() {
                currentZoom = parseInt(this.value);
                updateZoom();
            });

            // Botones de zoom
            zoomInBtn.addEventListener('click', function() {
                currentZoom = Math.min(300, currentZoom + 25);
                updateZoom();
            });

            zoomOutBtn.addEventListener('click', function() {
                currentZoom = Math.max(25, currentZoom - 25);
                updateZoom();
            });

            resetZoomBtn.addEventListener('click', function() {
                resetImagePosition();
            });

            // Función para actualizar el zoom
            function updateZoom() {
                const scale = currentZoom / 100;
                modalImg.style.transform = `translate(-50%, -50%) scale(${scale})`;
                zoomSlider.value = currentZoom;
                zoomLevel.textContent = currentZoom + '%';
            }

            // Zoom con scroll del mouse
            imageContainer.addEventListener('wheel', function(e) {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -25 : 25;
                currentZoom = Math.max(25, Math.min(300, currentZoom + delta));
                updateZoom();
            });

            // Funcionalidad de arrastrar - CORREGIDA
            let currentX = 0, currentY = 0;

            imageContainer.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);

            // Touch events para móviles
            imageContainer.addEventListener('touchstart', startDragTouch, { passive: false });
            document.addEventListener('touchmove', dragTouch, { passive: false });
            document.addEventListener('touchend', endDrag);

            function startDrag(e) {
                if (currentZoom > 100) {
                    e.preventDefault();
                    isDragging = true;
                    imageContainer.classList.add('dragging');
                    startX = e.clientX - currentX;
                    startY = e.clientY - currentY;
                }
            }

            function startDragTouch(e) {
                if (currentZoom > 100) {
                    e.preventDefault();
                    isDragging = true;
                    imageContainer.classList.add('dragging');
                    startX = e.touches[0].clientX - currentX;
                    startY = e.touches[0].clientY - currentY;
                }
            }

            function drag(e) {
                if (!isDragging) return;
                e.preventDefault();
                currentX = e.clientX - startX;
                currentY = e.clientY - startY;
                updateImagePosition();
            }

            function dragTouch(e) {
                if (!isDragging) return;
                e.preventDefault();
                currentX = e.touches[0].clientX - startX;
                currentY = e.touches[0].clientY - startY;
                updateImagePosition();
            }

            function endDrag() {
                isDragging = false;
                imageContainer.classList.remove('dragging');
            }

            function updateImagePosition() {
                const scale = currentZoom / 100;
                modalImg.style.transform = `translate(calc(-50% + ${currentX}px), calc(-50% + ${currentY}px)) scale(${scale})`;
            }

            // Cerrar modal
            closeBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.style.display === 'block') {
                    closeModal();
                }
            });

            function closeModal() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                modalImg.src = '';
                modalImg.alt = '';
                modalTitle.textContent = 'Comunicado';
                currentX = 0;
                currentY = 0;
                resetImagePosition();
            }
        });
    </script>
}