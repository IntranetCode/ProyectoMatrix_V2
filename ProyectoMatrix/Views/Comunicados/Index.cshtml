@*
@{
    ViewData["Title"] = "Comunicados - Intranet";
    Layout = "~/Views/Shared/_Colaborador.cshtml";
}

@section Estilos {
    <style>
        .comunicado-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }

            .comunicado-card:hover {
                transform: translateY(-4px);
            }

        .comunicado-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #343a40;
        }

        .comunicado-meta {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 12px;
        }

        .comunicado-content {
            font-size: 1rem;
            color: #495057;
        }

        .comunicado-icon {
            font-size: 1.4rem;
            margin-right: 10px;
        }

        .icon-informativo {
            color: #17a2b8;
        }

        .icon-urgente {
            color: #dc3545;
        }

        .icon-aviso {
            color: #ffc107;
        }

        .comunicado-img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 15px;
        }

        @@media (min-width: 768px) {
            .comunicado-with-image

        {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .comunicado-text {
            flex: 1;
        }

        .comunicado-img {
            width: 250px;
            height: auto;
            margin-top: 0;
        }

        }
    </style>
}

<div class="container py-4">
    <h2 class="mb-4"><i class="fas fa-bullhorn"></i> Comunicados</h2>

    <!-- COMUNICADO 1: con imagen -->
    <div class="comunicado-card comunicado-with-image">
        <div class="comunicado-text">
            <div class="d-flex align-items-center comunicado-title">
                <i class="fas fa-info-circle comunicado-icon icon-informativo"></i>
                Actualización de políticas internas
            </div>
            <div class="comunicado-meta">Publicado: 01/07/2025 - Recursos Humanos</div>
            <div class="comunicado-content">
                A partir de julio se implementarán nuevas políticas relacionadas con asistencia, puntualidad y trabajo remoto. Revisa el manual actualizado.
            </div>
        </div>
        <img src="~/imagenes/politicas.jpg" alt="Políticas" class="comunicado-img" />
    </div>

    <!-- COMUNICADO 2: sin imagen -->
    <div class="comunicado-card">
        <div class="d-flex align-items-center comunicado-title">
            <i class="fas fa-exclamation-triangle comunicado-icon icon-urgente"></i>
            Corte de energía programado
        </div>
        <div class="comunicado-meta">Publicado: 29/06/2025 - Mantenimiento</div>
        <div class="comunicado-content">
            El viernes de 3:00 PM a 5:00 PM se realizará mantenimiento eléctrico. Guarda tu trabajo y apaga tus equipos antes de salir.
        </div>
    </div>

    <!-- COMUNICADO 3: con imagen -->
    <div class="comunicado-card comunicado-with-image">
        <div class="comunicado-text">
            <div class="d-flex align-items-center comunicado-title">
                <i class="fas fa-bell comunicado-icon icon-aviso"></i>
                Aviso de nómina
            </div>
            <div class="comunicado-meta">Publicado: 28/06/2025 - Finanzas</div>
            <div class="comunicado-content">
                La nómina de esta quincena estará disponible a partir del jueves. Si tienes dudas, consulta con Recursos Humanos.
            </div>
        </div>
        <img src="~/imagenes/nomina.png" alt="Nómina" class="comunicado-img" />
    </div>
</div>
*@

@{
    ViewData["Title"] = "Comunicados - Intranet";
    Layout = "~/Views/Shared/_Colaborador.cshtml";
}
@section Estilos {
    <style>
        .comunicado-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }

            .comunicado-card:hover {
                transform: translateY(-4px);
            }

        .comunicado-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #343a40;
        }

        .comunicado-meta {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 12px;
        }

        .comunicado-content {
            font-size: 1rem;
            color: #495057;
        }

        .comunicado-icon {
            font-size: 1.4rem;
            margin-right: 10px;
        }

        .icon-informativo {
            color: #17a2b8;
        }

        .icon-urgente {
            color: #dc3545;
        }

        .icon-aviso {
            color: #ffc107;
        }

        .comunicado-img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

            .comunicado-img:hover {
                transform: scale(1.02);
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                border-color: #007bff;
            }

            .comunicado-img:active {
                transform: scale(0.98);
            }

        /* Modal personalizado con zoom y pan */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.95);
            animation: fadeIn 0.3s;
        }

        .image-modal-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .image-modal-header {
            color: white !important;
            text-align: center !important;
            padding: 15px 20px !important;
            font-size: 1.2rem !important;
            font-weight: 500 !important;
            background: rgba(0,0,0,0.9) !important;
            z-index: 10001 !important;
            position: relative !important;
        }

        .image-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

            .image-container.dragging {
                cursor: grabbing;
            }

        .modal-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: none;
            max-height: none;
            transition: transform 0.1s ease;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
        }

        /* Controles de zoom - FIJOS Y SIEMPRE VISIBLES */
        .zoom-controls {
            position: fixed !important;
            bottom: 30px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            display: flex !important;
            gap: 8px !important;
            background: rgba(0,0,0,0.9) !important;
            padding: 15px 20px !important;
            border-radius: 30px !important;
            z-index: 10001 !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5) !important;
            border: 2px solid rgba(255,255,255,0.2) !important;
        }

        .zoom-btn {
            background: rgba(255,255,255,0.15) !important;
            border: 1px solid rgba(255,255,255,0.3) !important;
            color: white !important;
            width: 45px !important;
            height: 45px !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            font-size: 16px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.2s !important;
            font-weight: bold !important;
        }

            .zoom-btn:hover {
                background: rgba(255,255,255,0.25) !important;
                transform: scale(1.05) !important;
                border-color: rgba(255,255,255,0.5) !important;
            }

            .zoom-btn:active {
                transform: scale(0.95) !important;
                background: rgba(255,255,255,0.35) !important;
            }

        .zoom-slider {
            width: 120px !important;
            margin: 0 15px !important;
            align-self: center !important;
        }

        .zoom-level {
            color: white !important;
            font-size: 15px !important;
            font-weight: bold !important;
            min-width: 55px !important;
            text-align: center !important;
            align-self: center !important;
            background: rgba(255,255,255,0.1) !important;
            padding: 8px 12px !important;
            border-radius: 15px !important;
            border: 1px solid rgba(255,255,255,0.2) !important;
        }

        /* Botón de cerrar mejorado y SIEMPRE VISIBLE */
        .image-modal-close {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            color: white !important;
            font-size: 24px !important;
            font-weight: bold !important;
            cursor: pointer !important;
            background: rgba(255,0,0,0.8) !important;
            border-radius: 50% !important;
            width: 55px !important;
            height: 55px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.3s !important;
            z-index: 10002 !important;
            border: 2px solid rgba(255,255,255,0.3) !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4) !important;
        }

            .image-modal-close:hover {
                background: rgba(255,0,0,0.95) !important;
                transform: scale(1.1) !important;
                border-color: rgba(255,255,255,0.6) !important;
            }

        @@keyframes fadeIn {
            from

        {
            opacity: 0;
        }

        to {
            opacity: 1;
        }

        }

        /* Badge para indicar que es clickeable */
        .img-clickable-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,123,255,0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s;
            transform: translateY(-5px);
        }

        .comunicado-img-container {
            position: relative;
            display: inline-block;
        }

            .comunicado-img-container:hover .img-clickable-badge {
                opacity: 1;
                transform: translateY(0);
            }

        @@media (min-width: 768px) {
            .comunicado-with-image

        {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .comunicado-text {
            flex: 1;
        }

        .comunicado-img {
            width: 250px;
            height: auto;
            margin-top: 0;
        }

        }

        /* Instrucciones en el modal - MEJORADAS Y VISIBLES */
        .modal-instructions {
            position: fixed !important;
            top: 80px !important;
            left: 20px !important;
            color: rgba(255,255,255,0.9) !important;
            font-size: 0.9rem !important;
            background: rgba(0,0,0,0.8) !important;
            padding: 12px 16px !important;
            border-radius: 10px !important;
            z-index: 10001 !important;
            border: 1px solid rgba(255,255,255,0.2) !important;
            max-width: 280px !important;
        }

        /* Slider personalizado */
        .zoom-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: rgba(255,255,255,0.3);
            outline: none;
            border-radius: 2px;
        }

            .zoom-slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 18px;
                height: 18px;
                background: #007bff;
                cursor: pointer;
                border-radius: 50%;
                border: 2px solid white;
            }

            .zoom-slider::-moz-range-thumb {
                width: 18px;
                height: 18px;
                background: #007bff;
                cursor: pointer;
                border-radius: 50%;
                border: 2px solid white;
            }
    </style>
}

<div class="container py-4">
    <h2 class="mb-4"><i class="fas fa-bullhorn"></i> Comunicados</h2>

    <!-- COMUNICADO 1: Felicitaciones de Cumpleaños -->
    <div class="comunicado-card comunicado-with-image">
        <div class="comunicado-text">
            <div class="d-flex align-items-center comunicado-title">
                <i class="fas fa-birthday-cake comunicado-icon icon-informativo"></i>
                ¡Felicitaciones a nuestros cumpleañeros de julio!
            </div>
            <div class="comunicado-meta">Publicado: 01/07/2025 - Recursos Humanos</div>
            <div class="comunicado-content">
                En NS Group celebramos a nuestro equipo. Este mes felicitamos a todos nuestros colaboradores que cumplen años en julio. ¡Que tengan un excelente día!
            </div>
        </div>
        <div class="comunicado-img-container">
            <img src="~/imagenes/comunicados/cumpleanos-julio.jpg"
                 alt="Cumpleañeros de Julio"
                 class="comunicado-img clickable-image"
                 data-title="Felicitaciones a nuestros cumpleañeros de julio" />
            <div class="img-clickable-badge">
                <i class="fas fa-search-plus"></i> Click para ampliar
            </div>
        </div>
    </div>

    <!-- COMUNICADO 2: Bienvenida nuevo colaborador -->
    <div class="comunicado-card comunicado-with-image">
        <div class="comunicado-text">
            <div class="d-flex align-items-center comunicado-title">
                <i class="fas fa-user-plus comunicado-icon icon-informativo"></i>
                Le damos la más cordial bienvenida a Luis Alonso
            </div>
            <div class="comunicado-meta">Publicado: 26/06/2025 - Comunicación Interna</div>
            <div class="comunicado-content">
                Nos complace anunciar que Luis Alonso Basurto Martínez se integra a nuestro equipo como Asesor de Equipamiento. ¡Le deseamos mucho éxito!
            </div>
        </div>
        <div class="comunicado-img-container">
            <img src="~/imagenes/comunicados/bienvenida-luis.png"
                 alt="Bienvenida Luis Alonso"
                 class="comunicado-img clickable-image"
                 data-title="Bienvenida a Luis Alonso Basurto Martínez" />
            <div class="img-clickable-badge">
                <i class="fas fa-search-plus"></i> Click para ampliar
            </div>
        </div>
    </div>

    <!-- COMUNICADO 3: Solicitudes por WhatsApp -->
    <div class="comunicado-card comunicado-with-image">
        <div class="comunicado-text">
            <div class="d-flex align-items-center comunicado-title">
                <i class="fas fa-mobile-alt comunicado-icon icon-aviso"></i>
                Nuevas solicitudes por WhatsApp
            </div>
            <div class="comunicado-meta">Publicado: 25/06/2025 - Sistemas</div>
            <div class="comunicado-content">
                A partir de ahora, los colaboradores podrán realizar solicitudes de compras, logística y otros servicios a través de WhatsApp con código QR.
            </div>
        </div>
        <div class="comunicado-img-container">
            <img src="~/imagenes/comunicados/formulario_compras.png"
                 alt="Formulario Compras"
                 class="comunicado-img clickable-image"
                 data-title="Formulario Compras - Código QR" />
            <div class="img-clickable-badge">
                <i class="fas fa-search-plus"></i> Click para ampliar
            </div>
        </div>
    </div>

    <!-- COMUNICADO 4: sin imagen -->
    <div class="comunicado-card">
        <div class="d-flex align-items-center comunicado-title">
            <i class="fas fa-exclamation-triangle comunicado-icon icon-urgente"></i>
            Mantenimiento de sistemas programado
        </div>
        <div class="comunicado-meta">Publicado: 24/06/2025 - Sistemas</div>
        <div class="comunicado-content">
            El próximo viernes de 6:00 PM a 8:00 PM se realizará mantenimiento en los servidores. Los sistemas podrían presentar interrupciones durante este período.
        </div>
    </div>

    <!-- COMUNICADO 5: Recordatorio capacitación -->
    <div class="comunicado-card">
        <div class="d-flex align-items-center comunicado-title">
            <i class="fas fa-graduation-cap comunicado-icon icon-informativo"></i>
            Recordatorio: Capacitación en Universidad NS Group
        </div>
        <div class="comunicado-meta">Publicado: 23/06/2025 - Universidad NS Group</div>
        <div class="comunicado-content">
            No olvides completar los cursos asignados en la Universidad NS Group. El plazo vence el 30 de junio. ¡Tu desarrollo profesional es importante para nosotros!
        </div>
    </div>
</div>

<!-- Modal con zoom y pan -->
<div id="imageModal" class="image-modal">
    <div class="image-modal-content">
        <span class="image-modal-close">&times;</span>
        <div class="image-modal-header" id="modalTitle">Comunicado</div>
        <div class="modal-instructions">
            <i class="fas fa-info-circle"></i> Usa los controles para hacer zoom y arrastra para mover la imagen
        </div>

        <div class="image-container" id="imageContainer">
            <img id="modalImage" class="modal-image" src="" alt="">
        </div>

        <div class="zoom-controls">
            <button class="zoom-btn" id="zoomOut" title="Alejar">
                <i class="fas fa-minus"></i>
            </button>
            <input type="range" class="zoom-slider" id="zoomSlider" min="25" max="300" value="100" step="25">
            <div class="zoom-level" id="zoomLevel">100%</div>
            <button class="zoom-btn" id="zoomIn" title="Acercar">
                <i class="fas fa-plus"></i>
            </button>
            <button class="zoom-btn" id="resetZoom" title="Tamaño original">
                <i class="fas fa-expand-arrows-alt"></i>
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables para el modal y zoom
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const closeBtn = document.querySelector('.image-modal-close');
            const imageContainer = document.getElementById('imageContainer');
            const zoomSlider = document.getElementById('zoomSlider');
            const zoomLevel = document.getElementById('zoomLevel');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const resetZoomBtn = document.getElementById('resetZoom');

            let currentZoom = 100;
            let isDragging = false;
            let startX, startY, initialX, initialY;

            // Abrir modal con imagen
            document.querySelectorAll('.clickable-image').forEach(function(img) {
                img.addEventListener('click', function() {
                    const imgSrc = this.src;
                    const imgAlt = this.alt;
                    const imgTitle = this.getAttribute('data-title') || imgAlt;

                    const testImg = new Image();
                    testImg.onload = function() {
                        modalImg.src = imgSrc;
                        modalImg.alt = imgAlt;
                        modalTitle.textContent = imgTitle;
                        modal.style.display = 'block';
                        document.body.style.overflow = 'hidden';
                        resetImagePosition();
                    };
                    testImg.onerror = function() {
                        alert('La imagen no está disponible en este momento.');
                    };
                    testImg.src = imgSrc;
                });
            });

            // Función para resetear posición y zoom
            function resetImagePosition() {
                currentZoom = 100;
                modalImg.style.transform = 'translate(-50%, -50%) scale(1)';
                zoomSlider.value = 100;
                zoomLevel.textContent = '100%';
            }

            // Control de zoom con slider
            zoomSlider.addEventListener('input', function() {
                currentZoom = parseInt(this.value);
                updateZoom();
            });

            // Botones de zoom
            zoomInBtn.addEventListener('click', function() {
                currentZoom = Math.min(300, currentZoom + 25);
                updateZoom();
            });

            zoomOutBtn.addEventListener('click', function() {
                currentZoom = Math.max(25, currentZoom - 25);
                updateZoom();
            });

            resetZoomBtn.addEventListener('click', function() {
                resetImagePosition();
            });

            // Función para actualizar el zoom
            function updateZoom() {
                const scale = currentZoom / 100;
                modalImg.style.transform = `translate(-50%, -50%) scale(${scale})`;
                zoomSlider.value = currentZoom;
                zoomLevel.textContent = currentZoom + '%';
            }

            // Zoom con scroll del mouse
            imageContainer.addEventListener('wheel', function(e) {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -25 : 25;
                currentZoom = Math.max(25, Math.min(300, currentZoom + delta));
                updateZoom();
            });

            // Funcionalidad de arrastrar - CORREGIDA
            let currentX = 0, currentY = 0;

            imageContainer.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);

            // Touch events para móviles
            imageContainer.addEventListener('touchstart', startDragTouch, { passive: false });
            document.addEventListener('touchmove', dragTouch, { passive: false });
            document.addEventListener('touchend', endDrag);

            function startDrag(e) {
                if (currentZoom > 100) {
                    e.preventDefault();
                    isDragging = true;
                    imageContainer.classList.add('dragging');
                    startX = e.clientX - currentX;
                    startY = e.clientY - currentY;
                }
            }

            function startDragTouch(e) {
                if (currentZoom > 100) {
                    e.preventDefault();
                    isDragging = true;
                    imageContainer.classList.add('dragging');
                    startX = e.touches[0].clientX - currentX;
                    startY = e.touches[0].clientY - currentY;
                }
            }

            function drag(e) {
                if (!isDragging) return;
                e.preventDefault();
                currentX = e.clientX - startX;
                currentY = e.clientY - startY;
                updateImagePosition();
            }

            function dragTouch(e) {
                if (!isDragging) return;
                e.preventDefault();
                currentX = e.touches[0].clientX - startX;
                currentY = e.touches[0].clientY - startY;
                updateImagePosition();
            }

            function endDrag() {
                isDragging = false;
                imageContainer.classList.remove('dragging');
            }

            function updateImagePosition() {
                const scale = currentZoom / 100;
                modalImg.style.transform = `translate(calc(-50% + ${currentX}px), calc(-50% + ${currentY}px)) scale(${scale})`;
            }

            // Cerrar modal
            closeBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.style.display === 'block') {
                    closeModal();
                }
            });

            function closeModal() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                modalImg.src = '';
                modalImg.alt = '';
                modalTitle.textContent = 'Comunicado';
                currentX = 0;
                currentY = 0;
                resetImagePosition();
            }
        });
    </script>
}