@model ProyectoMatrix.Models.ComunicadoCreateVM
@{
    Layout = "_LayoutComunicados";
    ViewData["Title"] = "Editar Comunicado";
}
<h2>Editar Comunicado</h2>
@if (ViewBag.ImagenActual != null && !string.IsNullOrEmpty(ViewBag.ImagenActual))
{
    <div class="mb-3">
        <label class="form-label">Imagen Actual</label><br />
        <img src="@ViewBag.ImagenActual" alt="Imagen Actual" style= max-height: 120px;" />
    </div>
}

 <form asp-action="Editar" method="post" enctype="multipart/form-data">
@Html.AntiForgeryToken()

    <input type="hidden" name="id" value="@ViewBag.ComunicadoID" />

    <div class="mb-3">
        <label class="form-label">Título</label>
        <input asp-for="NombreComunicado" class="form-control" />
        <span asp-validation-for="NombreComunicado" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Descripción</label>
        <textarea asp-for="Descripcion" class="form-control"></textarea>
        <span asp-validation-for="Descripcion" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label class=" form-label">Fecha </label>
        <input asp-for="FechaCreacion" class="form-control" type="date" />
    </div>


    @*Se agrega el select de la categoria que tendra el comunicado*@

    <div class="mb-3">
        <label asp-for="Categoria" class="form-label">Categoría</label>
        <select asp-for="Categoria" class="form-select"
                asp-items="@(new SelectList(Model.CategoriasDisponibles ?? new List<string> { "Urgente", "General", "Evento" }))">
            <option value="">-- Selecciona una categoría --</option>
        </select>
        <span asp-validation-for="Categoria" class="text-danger"></span>
    </div>



        <div class="mb-3">
        <label class="form-label">Cambiar Imagen</label>
        <input asp-for="ImagenFile" class="form-control" type="file" />
    </div>
    <div class="mb-3 form-check">
        <input asp-for="EsPublico" class="form-check-input" id="chkTodos" />
        <label class="form-check-label" for="chkTodos">Enviar a todos los usuarios</label>
    </div>

    <div class="mb-3" id="empresasBox">
        <label class="form-label">Seleccionar Empresas (Si no es para todos)</label>
        <div class="row">
            @foreach (var e in Model.Empresas)
            {
                var seleccionado = Model.EmpresasSeleccionadas != null && Model.EmpresasSeleccionadas.Contains(e.EmpresaID);
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="EmpresasSeleccionadas"
                        value="@e.EmpresaID" id="emp_@e.EmpresaID"  @(seleccionado ? "checked" : "" ) />
                        <label class="form-check-label" for="emp_@e.EmpresaID">@e.Nombre</label>
                    </div>
                </div>
}
        </div>
    </div>
    <button type="submit" class="btn btn-primary">Guardar cambios</button>
    <a asp-action="Gestionar" class="btn btn-secondary">Cancelar</a>
</form>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function(){
            const chk = document.getElementById('chkTodos');
            const box = document.getElementById('empresasBox');
            function refresh(){ box.style.display = chk.checked ? 'none' : 'block'; }
            if (chk) {
                chk.addEventListener('change', refresh);
                refresh();
            }
            
        })();
    </script>
}
