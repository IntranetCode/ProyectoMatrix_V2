@using ProyectoMatrix.Servicios
@using ProyectoMatrix.Models
@model Proyecto
@{
    var rol = Context.Session.GetString("Rol") ?? "Colaborador";
    Layout = rol == "Administrador" ? "~/Views/Shared/_Layout.cshtml" : "~/Views/Shared/_LayoutComunicados.cshtml";
}
@*Mandar a llamar al servicio de acceso para ocultar o mostrar los botones correspondientes *@
@inject IServicioAcceso Acceso
@{
    var usuarioId = int.Parse(User.FindFirst("UsuarioID").Value);
    var puedeCrear = await Acceso.TienePermisoAsync(usuarioId, "Proyectos", "Crear");
    var puedeEditar = await Acceso.TienePermisoAsync(usuarioId, "Proyectos", "Editar");
    var puedeEliminar = await Acceso.TienePermisoAsync(usuarioId, "Proyectos", "Eliminar");
}


<link href="~/css/stylesProyectosCrear.css" rel="stylesheet" />

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0"><i class="fas fa-file-upload me-2 text-primary "></i>Cargar un proyecto finalizado</h1>
            <p class="text-muted">Agrega la información del proyecto y carga los archivos</p>

        </div>
        <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
             <i class="fas fa-arrow-left me-1"></i> Volver a la vista principal
        </a>

    </div>

    @*Formulario para pedir datos generales del proyecto ya terminado*@

    <form id="formCargarProyecto" asp-action="Cargar" method="post" enctype="multipart/form-data" class="form-container">
    @Html.AntiForgeryToken()
     <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
    
     @*Informacion general del proyecto ya finalizado*@
     <div class="form-section">
            <h5><i class="fas fa-address-card me-2"></i>Informacion básica</h5>
            <div class="row">
                <div class="col-md-8">
                    <div class="mb-3">
                        <label asp-for="NombreProyecto" class="form-label">
                            <i class="fas fa-project-diagram me-1"></i> Nombre del proyecto 
                        </label>
                        <input asp-for="NombreProyecto" class="form-control form-control-lg"
                          placeholder="Ingrese el nombre del proyecto" required/>
                          <span asp-validation-for="NombreProyecto" class="form-label"></span>


                    </div>
                </div>

                <div class="col-md-4"> 
                    <div class="mb-3">
                        <label asp-for="CodigoProyecto" class="form-label">
                            <i class="fas fa-hashtag me-1"></i>Codigo del proyecto
                        </label>
                        <input asp-for="CodigoProyecto" class="form-control" 
                        placeholder="PRY-XXXX-XXX"/>
                        <span asp-validation-for="CodigoProyecto" class="text-danger"></span>

                    </div>

                </div>

                <div class="col-md-8">
                    <div class="mb-3">
                        <label asp-for="Cliente" class="form-label">
                            <i class="fas fa-building me-1"></i>Cliente
                        </label>
                        <input asp-for="Cliente" class="form-control"
                               placeholder="Ingrese el nombre del cliente" />
                        <span asp-validation-for="Cliente" class="text-danger"></span>
                    </div>

                </div>

                <div class="col-md-8">
                    <div class="mb-3">
                        <label asp-for="Ubicacion" class="form-label">
                            <i class="fas fa-map-marker-alt me-1"></i> Ubicacion del proyecto
                        </label>
                        <input asp-for="Ubicacion" class="form-control"
                               placeholder="Ingrese la ubicacion del proyecto" />
                        <span asp-validation-for="Ubicacion" class="text-danger"></span>
                    </div>

                </div>

                <div class="col-md-8">
                    <div class="mb-3">
                        <label asp-for="Tipo" class="form-label">
                            <i class="fas fa-tag me-1"></i>
                            Tipo
                        </label>
                        <input asp-for="Tipo" class="form-control" 
                         placeholder="Ingrese el tipo de proyecto que se desarrollo"/>
                         <span asp-validation-for="Tipo" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-8">
                <div class="mb-3">
                      
                       <label asp-for="Descripcion" class="form-label">
                           <i class="fas fa-aling-left me-1"></i>Descripcion
                       </label>
                       <textarea asp-for="Descripcion" class="form-control" rows="3"
                       placeholder="Describe brevemente el proyecto que se desarrolló"></textarea>
                       <span asp-validation-for="Descripcion" class="text-danger"></span>
                    </div>
                </div>

            </div>
     </div>


    @*SECCION DE ESTADO Y PRIORIDAD SE LLENA EN AUTOMATICO DESDE EL CONTROLADOR*@


    @*Seccion de fecha de fechas en este caso finales *@
    <div class="form-section">
        <h5><i class="fas fa-calendar-alt me-2"></i>Fechas</h5>
        <div class="row">
            <div class="col-md-4">
                <div class="mb-3">
                    <label asp-for="FechaInicio" class="form-label">
                        <i class="fas fa-play-circle me-1"></i> Fecha de inicio
                    </label>
                    <input asp-for="FechaInicio" type="date" class="form-control" />
                    <span asp-validation-for="FechaInicio" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-4">
                <div class="mb-3">
                    <label asp-for="FechaFinReal" class="form-label">
                            <i class="fas fa-flag-checkered  me-1"></i>Fecha de culminación del proyecto
                    </label>
                    <input asp-for="FechaFinReal" type="date" class="form-control"/>
                    <span asp-validation-for="FechaFinReal" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-4">
                    <div class="mb-3">
                        <label asp-for="ResponsableProyecto" class="form-label">
                            <i class="fas fa-user-tie me-1"></i>Responsable del Proyecto
                        </label>
                        <input asp-for="ResponsableProyecto" class="form-control"
                               placeholder="Nombre del responsable" />
                        <span asp-validation-for="ResponsableProyecto" class="text-danger"></span>
                    </div>
            </div>
           



        </div>
    </div>


    @*SUBIR ARCHIVOS*@

    <div class="col-md-4">
        <div class="mb-3">
            <div class="info-card" id="gestor-archivos"
            data-proyecto ="@Model.ProyectoID"
            data-puede-crear="@puedeCrear.ToString().ToLower()"
            data-puede-editar="@puedeEditar.ToString().ToLower()"
            data-puede-eliminar="@puedeEliminar.ToString().ToLower()">

            <h6><i class="fas fa-folder-open me-2"></i>Gestor de archivos</h6>

                    <!-- Anti-CSRF para AJAX -->
                    <form id="ga-antiforgery">@Html.AntiForgeryToken()</form>

                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb" class="mb-3">
                        <ol class="breadcrumb mb-0" id="ga-breadcrumb"></ol>
                    </nav>


           @*Toolbar*@
           <div class="d-flex flex-wrap gap-2 mb-3">
               @if(puedeCrear)
                        {
                            <div class="btn-group">
                                <button type="button" class="btn btn-primary" id="ga-subir-btn">
                                    <i class="fas fa-upload me-1"></i>Subir archivos
                                </button>
                                <input type="file" id="ga-file-input" multiple hidden/>
                            </div>
                            <button type="button" class="btn btn-outline-primary" id="ga-nueva-carpeta-btn">
                                <i class="fas fa-folder-plus me-1"></i> Nueva carpeta
                            </button>
                        }
                        <button type="button" class="btn btn-outline-secondary" id="ga-recargar-btn">
                            <i class="fas fa-rotate-right me-1"></i>
                        </button>
                    </div>

           @*tabla*@
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width:36px;"></th>
                                    <th>Nombre</th>
                                    <th style="width:140px;">Tamaño</th>
                                    <th style="width:160px;">Modificado</th>
                                    <th style="width:200px;">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="ga-lista"></tbody>
                        </table>
                    </div>
           @*Progreso*@
                    <div class="progress mt-3 d-none" id="ga-progress-wrap" style="height:10px;">
                        <div class="progress-bar" id="ga-progress" role="progressbar" style="width:0;"></div>
                    </div>

        </div>

        </div>
    </div>


    </form>
    

</div>